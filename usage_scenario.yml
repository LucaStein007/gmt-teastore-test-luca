name: TeaStore Measurement on GMT Cluster
author: Luca
description: Deploys TeaStore via its docker-compose_default.yaml, and runs a load test using hey.

services:
  compose-manager:
    image: docker/compose:latest 
  load-generator:
    image: demisto/rakyll-hey:1.0.0.108484

flow:
  - name: Start TeaStore Services via Docker Compose
    container: compose-manager
    working_dir: "." # Da die usage_scenario.yml im Root des TeaStore-Repos liegt
    commands:
      - type: console
        command: "docker-compose -f ./examples/docker/docker-compose_default.yaml up -d"
        note: "Starting TeaStore Docker Compose services."
      - type: console
        command: "sleep 120" # Dem TeaStore Zeit geben, um vollst√§ndig zu starten
        note: "Waiting 120 seconds for TeaStore services to initialize."

  - name: Run Load Test on TeaStore Homepage
    container: load-generator
    commands:
      - type: console
        # Der Service-Name 'webui' sollte in der TeaStore docker-compose_default.yaml definiert sein
        command: "hey -z 60s -c 20 http://webui:8080/tools.descartes.teastore.webui/"
        note: "Starting 60s load test with 20 concurrent users on TeaStore homepage."

  - name: Run Load Test on TeaStore Category Page
    container: load-generator
    commands:
      - type: console
        command: "hey -z 60s -c 10 http://webui:8080/tools.descartes.teastore.webui/categories?category=2&page=1"
        note: "Starting 60s load test with 10 concurrent users on a TeaStore category page."

  - name: Stop TeaStore Services
    container: compose-manager
    working_dir: "."
    commands:
      - type: console
        command: "docker-compose -f ./examples/docker/docker-compose_default.yaml down -v"
        note: "Stopping TeaStore Docker Compose services and removing volumes."
